package Strategy;

import java.io.File;

import Exceptions.RequestException;
import Serveur.FtpRequest;
import Serveur.ftp;

public class RequestCWD implements Request{

	public void doRequest(FtpRequest ftp, String[] request)
			throws RequestException {

		String argument = request[1];
		String path = "/";

		// EXIT if no argument
		if (argument.isEmpty()) {
			ftp.sendMessage("501 Syntax error in parameters");
			return;
		}
		// EXIT if trying to go back with these command
		if (argument.contains("..")) {
			ftp.sendMessage("550 No access to parent folder");
			return;
		}

		// Root path
		else if (argument.equals("/")) {
			path = "/";
		}
		// Absolute path
		else if (argument.startsWith("/")) {
			path = argument + "/";
		}
		// Relative path
		else {
			path = ftp.getServerPath() + argument + "/";
		}

		// Check and set path
		File dir = new File(ftp.getClient().getPathname(), path);
		if (dir.isFile()) {
			ftp.sendMessage("550 Cannot go into a file (CWD on file)");
		} else if (!dir.exists()) {
			ftp.sendMessage("550 No such directory");
		} else {
			ftp.setPath(path);
			ftp.sendMessage("250 CWD command successfull");
		}
	}



}
