package Strategy;

import java.nio.file.Path;
import java.nio.file.Paths;

import Exceptions.RequestDroitException;
import Exceptions.RequestException;
import Serveur.FtpRequest;

public class RequestCDUP implements Request{

	public void doRequest(FtpRequest ftp, String[] request)
			throws RequestException {
		
		String path = "/";
		
		if (request.length != 2) {
			ftp.sendMessage("501 Syntax error in parameters");
			return;
		}

		if (request[1].contains("..")) {
			session.sendCommand("550 No access to parent folder");
			return;
		}
		
		// Root path
		else if (argument.equals("/")) {
			path = "/";
		} 
		// Absolute path
		else if (argument.startsWith("/")) {
			path = argument + "/";
		}
		// Relative path
		else {
			path = session.getPath() + argument + "/";
		}
		
		// Check and set path
		File dir = new File(session.getUser().getHomeFolder(), path);
		if (dir.isFile()) {
			session.sendCommand("550 Cannot go into a file (CWD on file)");
		} else if (!dir.exists()) {
			session.sendCommand("550 No such directory");
		} else {
			session.setPath(path);
			session.sendCommand("250 CWD command successfull");
		}
	}



}
